rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // =========================================
    // Rooms Collection
    // =========================================
    match /rooms/{roomId} {
      // อนุญาตให้ทุกคนอ่านข้อมูลห้อง
      allow read: if true;

      // อนุญาตให้สร้างห้องใหม่ได้
      allow create: if true;

      // อนุญาตให้อัพเดทได้ทุกคน (สำหรับ join/leave room)
      allow update: if true;

      // อนุญาตให้ลบได้
      allow delete: if true;

      // Players Subcollection (สำหรับผู้เล่นในห้อง)
      match /players/{playerId} {
        allow read: if true;
        allow write: if true;
      }
    }

    // =========================================
    // Players Collection
    // =========================================
    match /players/{playerId} {
      allow read: if true;
      allow create: if true;
      allow update: if true;
      allow delete: if true;
    }

    // =========================================
    // Chat Messages Collection
    // =========================================
    match /chat/{roomId}/messages/{messageId} {
      allow read: if true;
      allow create: if true;
      allow update, delete: if false;
    }

    // =========================================
    // Game Results Collection
    // =========================================
    match /results/{resultId} {
      allow read: if true;
      allow create: if true;
      allow update, delete: if false;
    }

    // =========================================
    // Games Collection
    // =========================================
    match /games/{gameId} {
      allow read: if true;
      allow write: if false; // เขียนได้เฉพาะ Admin
    }

    // =========================================
    // ITO Questions Collection
    // =========================================
    match /ito_questions/{questionId} {
      allow read: if true;
      allow write: if false;
    }

    // =========================================
    // Game Sessions Collection
    // =========================================
    match /game_sessions/{sessionId} {
      allow read: if true;
      allow create: if true;
      allow update: if true;
      allow delete: if true;

      // Player Answers Subcollection
      match /player_answers/{playerId} {
        allow read: if true;
        allow write: if true;
      }

      // Votes Subcollection
      match /votes/{playerId} {
        allow read: if true;
        allow write: if true;
      }

      // Ready Status Subcollection (for levelComplete phase)
      match /ready_status/{playerId} {
        allow read: if true;
        allow write: if true;
      }
    }

    // =========================================
    // Test Collection (for testing only)
    // =========================================
    match /test/{document=**} {
      allow read, write: if true;
    }
  }
}
